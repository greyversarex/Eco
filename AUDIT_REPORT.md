# üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–£–î–ò–¢ –°–ò–°–¢–ï–ú–´ ECODOC
**–ü–æ—Ä—Ç–∞–ª —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–∞ –æ—Ö—Ä–∞–Ω—ã –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–∞**

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 24 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–ê—É–¥–∏—Ç–æ—Ä:** Replit Agent (Claude 4.5 Sonnet + Architect)

---

## üìä –ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ï –†–ï–ó–Æ–ú–ï

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ç—É—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: –¢–†–ï–ë–£–ï–¢–°–Ø –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ï –í–ú–ï–®–ê–¢–ï–õ–¨–°–¢–í–û

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** üî¥ **–ö–†–ò–¢–ò–ß–ù–û** - –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å–µ—Ä—å—ë–∑–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** ‚ùå **–ù–ï –ì–û–¢–û–í–ê** - —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º

### –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏:
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –•–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∞, —Å–ª–µ–¥—É–µ—Ç best practices
- ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ö–µ–º–∞ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –∫–∞—Å–∫–∞–¥–Ω—ã–º–∏ —É–¥–∞–ª–µ–Ω–∏—è–º–∏
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Zod –¥–ª—è —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
- üî¥ **CSRF –∑–∞—â–∏—Ç–∞:** –û–¢–°–£–¢–°–¢–í–£–ï–¢ - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å
- üî¥ **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- üü° **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç rate limiting –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç brute-force
- üü° **Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:** VAPID –∫–ª—é—á–∏ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã (—Ç–æ–ª—å–∫–æ warning)

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 1. CSRF (Cross-Site Request Forgery) - –ö–†–ò–¢–ò–ß–ù–û ‚ö†Ô∏è

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏:** üî¥ **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô**  
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏:** –í–´–°–û–ö–ê–Ø  
**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —É—â–µ—Ä–±:** –í–´–°–û–ö–ò–ô

#### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

```typescript
// server/index.ts (—Å—Ç—Ä–æ–∫–∏ 40-47)
app.use(cors({
  origin: true,              // ‚ùå –†–∞–∑—Ä–µ—à–µ–Ω—ã –í–°–ï origins
  credentials: true,          // ‚ùå –†–∞–∑—Ä–µ—à–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ cookies
  exposedHeaders: ['set-cookie', 'Content-Type'],
  methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS', 'HEAD'],
}));

// server/index.ts (—Å—Ç—Ä–æ–∫–∏ 101-115)
cookie: {
  secure: isHTTPS,
  sameSite: isHTTPS ? 'none' : 'lax',  // ‚ùå –í HTTPS —Ä–µ–∂–∏–º–µ sameSite:'none'
}
```

**–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å:**
1. CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `origin: true` (—Ä–∞–∑—Ä–µ—à–µ–Ω—ã –í–°–ï –¥–æ–º–µ–Ω—ã)
2. `credentials: true` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å cookies —Å cross-origin –∑–∞–ø—Ä–æ—Å–∞–º–∏
3. –í HTTPS —Ä–µ–∂–∏–º–µ: `sameSite: 'none'` –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∞–µ—Ç –∑–∞—â–∏—Ç—É –±—Ä–∞—É–∑–µ—Ä–∞
4. **–û–¢–°–£–¢–°–¢–í–£–ï–¢** –∫–∞–∫–∞—è-–ª–∏–±–æ CSRF –∑–∞—â–∏—Ç–∞ (—Ç–æ–∫–µ–Ω—ã, –ø—Ä–æ–≤–µ—Ä–∫–∞ Referer/Origin)

#### –£—è–∑–≤–∏–º—ã–µ endpoints (49+ endpoints):

```typescript
// –ü—Ä–∏–º–µ—Ä—ã —É—è–∑–≤–∏–º—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
POST /api/messages                    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
POST /api/messages/broadcast          // –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞
POST /api/assignments                 // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π
DELETE /api/messages/:id              // –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
DELETE /api/assignments/:id           // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π
POST /api/announcements               // –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
PATCH /api/departments/:id            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤
POST /api/departments/:id/icon        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∫–æ–Ω–æ–∫
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏:

1. –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ —Å–æ–∑–¥–∞—ë—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Å–∞–π—Ç: `malicious-site.com`
2. –ñ–µ—Ä—Ç–≤–∞ (–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å EcoDoc) –ø–æ—Å–µ—â–∞–µ—Ç —ç—Ç–æ—Ç —Å–∞–π—Ç
3. –í—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π JavaScript –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ EcoDoc API:
```javascript
// –ù–∞ malicious-site.com
fetch('https://ecodoc.tj/api/messages', {
  method: 'POST',
  credentials: 'include',  // –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç cookies EcoDoc
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    subject: '–í—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
    recipientIds: [1,2,3,4,...,49],  // –í—Å–µ–º –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º
    content: '–§–∏—à–∏–Ω–≥ –∏–ª–∏ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'
  })
});
```
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç –∏–º–µ–Ω–∏ –∂–µ—Ä—Ç–≤—ã –í–°–ï–ú –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º

#### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:

- ‚úÖ –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∏–º–µ–Ω–∏ –ª—é–±–æ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å –∑–∞–¥–∞–Ω–∏—è, –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- ‚úÖ –ò–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ú–∞—Å—Å–æ–≤–æ —É–¥–∞–ª—è—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

#### –†–µ—à–µ–Ω–∏–µ (–°–†–û–ß–ù–û):

**–í–∞—Ä–∏–∞–Ω—Ç 1: CSRF —Ç–æ–∫–µ–Ω—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

```typescript
// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç
npm install csurf cookie-parser

// server/index.ts
import csrf from 'csurf';
import cookieParser from 'cookie-parser';

app.use(cookieParser());

// CSRF protection –¥–ª—è –≤—Å–µ—Ö state-changing –∑–∞–ø—Ä–æ—Å–æ–≤
const csrfProtection = csrf({ 
  cookie: {
    httpOnly: true,
    secure: isHTTPS,
    sameSite: isHTTPS ? 'strict' : 'lax'
  }
});

// –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ –≤—Å–µ–º POST/PUT/PATCH/DELETE
app.use('/api/*', (req, res, next) => {
  if (['POST', 'PUT', 'PATCH', 'DELETE'].includes(req.method)) {
    return csrfProtection(req, res, next);
  }
  next();
});

// Endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
app.get('/api/csrf-token', csrfProtection, (req, res) => {
  res.json({ csrfToken: req.csrfToken() });
});
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å CORS (–º–∏–Ω–∏–º—É–º)**

```typescript
// server/index.ts
const allowedOrigins = [
  'https://ecodoc.tj',
  'https://ecodoc.cc',
  process.env.ALLOWED_ORIGIN
].filter(Boolean);

app.use(cors({
  origin: (origin, callback) => {
    if (!origin || allowedOrigins.includes(origin)) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: true,
}));
```

**–í–∞—Ä–∏–∞–Ω—Ç 3: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–Ω–∞–∏–ª—É—á—à–∏–π)**

1. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å CORS –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
2. –î–æ–±–∞–≤–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—è—Ç—å Origin/Referer –∑–∞–≥–æ–ª–æ–≤–∫–∏
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sameSite: 'strict'` –≤ production

---

### 2. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ - –ö–†–ò–¢–ò–ß–ù–û ‚ö†Ô∏è

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏:** üî¥ **–í–´–°–û–ö–ò–ô**  
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏:** –°–†–ï–î–ù–Ø–Ø  
**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —É—â–µ—Ä–±:** –í–´–°–û–ö–ò–ô

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ MIME-—Ç–∏–ø–∞ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

```typescript
// server/routes.ts (—Å—Ç—Ä–æ–∫–∞ 70-75)
const upload = multer({
  storage: multer.memoryStorage(),
  limits: {
    fileSize: 100 * 1024 * 1024, // ‚ùå 100MB - –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π –ª–∏–º–∏—Ç
  },
  // ‚ùå –ù–ï–¢ fileFilter –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
});
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞** - –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –ª—é–±—ã–µ —Ñ–∞–π–ª—ã (exe, bat, sh, dll, etc.)
2. **–î–æ–≤–µ—Ä–∏–µ –∫ client-provided MIME type** - –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–æ–¥–¥–µ–ª–∞—Ç—å
3. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**
4. **–û—á–µ–Ω—å –±–æ–ª—å—à–æ–π –ª–∏–º–∏—Ç** - 100MB –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –æ–≥—Ä–æ–º–Ω—ã–µ —Ñ–∞–π–ª—ã

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–∫–æ–Ω–æ–∫ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤

```typescript
// server/routes.ts (—Å—Ç—Ä–æ–∫–∞ 432-437)
// ‚úÖ –¢–û–õ–¨–ö–û –¥–ª—è –∏–∫–æ–Ω–æ–∫ –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞
const { fileTypeFromBuffer } = await import('file-type');
const fileType = await fileTypeFromBuffer(req.file.buffer);

if (!fileType || !ALLOWED_ICON_MIME_TYPES.includes(fileType.mime)) {
  return res.status(400).json({ error: 'Invalid file type' });
}
```

**–¢–∞–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–ª—è:**
- POST /api/messages (—Å —Ñ–∞–π–ª–∞–º–∏)
- POST /api/messages/broadcast (—Å —Ñ–∞–π–ª–∞–º–∏)
- POST /api/assignments (—Å –≤–ª–æ–∂–µ–Ω–∏—è–º–∏)
- POST /api/announcements (—Å –≤–ª–æ–∂–µ–Ω–∏—è–º–∏)

#### –°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏:

1. –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Ñ–∞–π–ª: `virus.exe` –∫–∞–∫ `document.pdf`
2. –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î —Å –ø–æ–¥–¥–µ–ª–∞–Ω–Ω—ã–º MIME-—Ç–∏–ø–æ–º
3. –î—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∫–∞—á–∏–≤–∞—é—Ç "PDF", –ø–æ–ª—É—á–∞—è malware
4. –ê–Ω—Ç–∏–≤–∏—Ä—É—Å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫)

#### –†–µ—à–µ–Ω–∏–µ (–°–†–û–ß–ù–û):

```typescript
// server/routes.ts
import { fileTypeFromBuffer } from 'file-type';

// –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ MIME-—Ç–∏–ø—ã –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π
const ALLOWED_ATTACHMENT_TYPES = [
  'application/pdf',
  'application/vnd.openxmlformats-officedocument.wordprocessingml.document', // .docx
  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',       // .xlsx
  'application/msword',                                                       // .doc
  'application/vnd.ms-excel',                                                 // .xls
  'text/plain',
  'image/jpeg',
  'image/png',
  'image/gif',
];

// Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤
async function validateFileUpload(buffer: Buffer, fileName: string): Promise<string> {
  // 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π MIME —á–µ—Ä–µ–∑ –º–∞–≥–∏—á–µ—Å–∫–∏–µ –±–∞–π—Ç—ã
  const fileType = await fileTypeFromBuffer(buffer);
  
  if (!fileType) {
    throw new Error('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø —Ñ–∞–π–ª–∞');
  }
  
  if (!ALLOWED_ATTACHMENT_TYPES.includes(fileType.mime)) {
    throw new Error(`–¢–∏–ø —Ñ–∞–π–ª–∞ –Ω–µ —Ä–∞–∑—Ä–µ—à—ë–Ω: ${fileType.mime}`);
  }
  
  // 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
  const extension = fileName.split('.').pop()?.toLowerCase();
  const allowedExtensions = ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'txt', 'jpg', 'jpeg', 'png', 'gif'];
  
  if (!extension || !allowedExtensions.includes(extension)) {
    throw new Error('–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ');
  }
  
  // 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ)
  const maxSize = 10 * 1024 * 1024; // 10MB (–Ω–µ 100MB!)
  if (buffer.length > maxSize) {
    throw new Error('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π');
  }
  
  return fileType.mime;
}

// –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤–æ –≤—Å–µ—Ö upload endpoints
app.post("/api/messages", requireAuth, upload.array('files', 5), async (req, res) => {
  try {
    const files = req.files as Express.Multer.File[];
    
    // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª
    if (files && files.length > 0) {
      for (const file of files) {
        const validMime = await validateFileUpload(file.buffer, file.originalname);
        file.mimetype = validMime; // –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π
      }
    }
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
  } catch (error) {
    // ...
  }
});
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã:**
1. **–ê–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** (ClamAV –∏–ª–∏ –∞–Ω–∞–ª–æ–≥)
2. **–ö–∞—Ä–∞–Ω—Ç–∏–Ω** –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π)
3. **–°–Ω–∏–∑–∏—Ç—å –ª–∏–º–∏—Ç** –¥–æ 10MB
4. **Content Security Policy** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

---

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç Brute-Force –∞—Ç–∞–∫ - –í–´–°–û–ö–ò–ô –†–ò–°–ö üü°

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏:** üü° **–°–†–ï–î–ù–ò–ô/–í–´–°–û–ö–ò–ô**  
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏:** –°–†–ï–î–ù–Ø–Ø  
**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —É—â–µ—Ä–±:** –°–†–ï–î–ù–ò–ô

#### –ü—Ä–æ–±–ª–µ–º–∞:

```typescript
// server/routes.ts - Admin login (—Å—Ç—Ä–æ–∫–∏ 217-243)
app.post("/api/admin/login", async (req, res) => {
  // ‚ùå –ù–ï–¢ rate limiting
  // ‚ùå –ù–ï–¢ account lockout –ø–æ—Å–ª–µ N –ø–æ–ø—ã—Ç–æ–∫
  // ‚ùå –ù–ï–¢ captcha –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
  
  const { username, password } = req.body;
  const admin = await storage.getAdminByUsername(username);
  const passwordMatch = await bcrypt.compare(password, admin.password);
  
  if (!passwordMatch) {
    return res.status(401).json({ error: 'Invalid credentials' });
    // ‚ùå –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏, –Ω–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫
  }
});

// Department login (—Å—Ç—Ä–æ–∫–∏ 252-278)
app.post("/api/department/login", async (req, res) => {
  // ‚ùå –ù–ï–¢ rate limiting –¥–ª—è –∫–æ–¥–æ–≤ –¥–æ—Å—Ç—É–ø–∞
  // ‚ùå Department access codes –º–æ–∂–Ω–æ –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ
});
```

**–£—è–∑–≤–∏–º—ã–µ endpoints:**
- POST /api/admin/login - –õ–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- POST /api/department/login - –õ–æ–≥–∏–Ω –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞

#### –°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏:

–ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç:
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–±–æ—Ä–∞ –ø–∞—Ä–æ–ª–µ–π (brute-force)
2. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —É–≥–∞–¥–∞—Ç—å access codes –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä: ROHBAR001, ROHBAR002, ...)
3. –î–µ–ª–∞—Ç—å —Ç—ã—Å—è—á–∏ –ø–æ–ø—ã—Ç–æ–∫ –≤ —Å–µ–∫—É–Ω–¥—É –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

#### –†–µ—à–µ–Ω–∏–µ:

```typescript
// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç
npm install express-rate-limit

// server/index.ts
import rateLimit from 'express-rate-limit';

// Rate limiter –¥–ª—è login endpoints
const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: 5,                    // –º–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫
  message: {
    error: '–ó–∞–±–∞–≥–∞—Ç–æ —Å–ø—Ä–æ–± –≤—Ö–æ–¥—É. –°–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 15 —Ö–≤–∏–ª–∏–Ω'
  },
  standardHeaders: true,
  legacyHeaders: false,
  // –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ IP + username
  keyGenerator: (req) => {
    return `${req.ip}-${req.body?.username || req.body?.accessCode || 'unknown'}`;
  }
});

// –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ login endpoints
app.post("/api/admin/login", loginLimiter, async (req, res) => {
  // ... –∫–æ–¥ –ª–æ–≥–∏–Ω–∞
});

app.post("/api/department/login", loginLimiter, async (req, res) => {
  // ... –∫–æ–¥ –ª–æ–≥–∏–Ω–∞
});

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –≥–ª–æ–±–∞–ª—å–Ω—ã–π rate limiter –¥–ª—è API
const apiLimiter = rateLimit({
  windowMs: 1 * 60 * 1000,  // 1 –º–∏–Ω—É—Ç–∞
  max: 100,                  // 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
});

app.use('/api/', apiLimiter);
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã:**
1. **Account lockout** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ—Å–ª–µ 5 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
3. **CAPTCHA** –ø–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
4. **Email/SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
5. **Two-Factor Authentication (2FA)** –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

---

### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Å—Å–∏—è–º–∏ - –°–†–ï–î–ù–ò–ô –†–ò–°–ö üü°

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏:** üü° **–°–†–ï–î–ù–ò–ô**  
**–†–∏—Å–∫:** Session hijacking, session fixation

#### –ü—Ä–æ–±–ª–µ–º—ã:

```typescript
// server/index.ts (—Å—Ç—Ä–æ–∫–∏ 101-115)
cookie: {
  maxAge: 30 * 24 * 60 * 60 * 1000, // ‚ùå 30 –¥–Ω–µ–π - —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ
  httpOnly: true,                    // ‚úÖ –•–æ—Ä–æ—à–æ
  secure: isHTTPS,                   // ‚úÖ –•–æ—Ä–æ—à–æ
  sameSite: isHTTPS ? 'none' : 'lax', // ‚ö†Ô∏è 'none' –æ–ø–∞—Å–Ω–æ –±–µ–∑ CSRF –∑–∞—â–∏—Ç—ã
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–î–æ–ª–≥–∏–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏** - 30 –¥–Ω–µ–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç window –¥–ª—è hijacking
2. **–ù–µ—Ç —Ä–æ—Ç–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–∏** –ø—Ä–∏ —Å–º–µ–Ω–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
3. **–ù–µ—Ç idle timeout** - —Å–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞ –¥–∞–∂–µ –ø—Ä–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

#### –†–µ—à–µ–Ω–∏–µ:

```typescript
// server/index.ts
cookie: {
  maxAge: 7 * 24 * 60 * 60 * 1000,  // ‚úÖ 7 –¥–Ω–µ–π (–Ω–µ 30)
  httpOnly: true,
  secure: isHTTPS,
  sameSite: isHTTPS ? 'strict' : 'lax', // ‚úÖ strict –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è CSRF
}

// Middleware –¥–ª—è idle timeout
app.use((req, res, next) => {
  if (req.session && (req as any).session.lastActivity) {
    const idleTimeout = 30 * 60 * 1000; // 30 –º–∏–Ω—É—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    const timeSinceLastActivity = Date.now() - (req as any).session.lastActivity;
    
    if (timeSinceLastActivity > idleTimeout) {
      req.session.destroy((err) => {
        if (err) console.error('Session destroy error:', err);
      });
      return res.status(401).json({ error: 'Session expired due to inactivity' });
    }
  }
  
  if (req.session) {
    (req as any).session.lastActivity = Date.now();
  }
  
  next();
});

// –†–æ—Ç–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
async function regenerateSession(req: Request): Promise<void> {
  return new Promise((resolve, reject) => {
    const oldSession = { ...req.session };
    req.session.regenerate((err) => {
      if (err) return reject(err);
      Object.assign(req.session, oldSession);
      resolve();
    });
  });
}

// –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
app.post("/api/admin/login", async (req, res) => {
  // ... –ø—Ä–æ–≤–µ—Ä–∫–∞ credentials
  
  await regenerateSession(req);  // ‚úÖ –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞
  (req as any).session.adminId = admin.id;
  
  // ...
});
```

---

### 5. VAPID –∫–ª—é—á–∏ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã - –ù–ò–ó–ö–ò–ô –†–ò–°–ö ‚ö†Ô∏è

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏:** üü° **–ù–ò–ó–ö–ò–ô/–°–†–ï–î–ù–ò–ô**  
**–ü—Ä–æ–±–ª–µ–º–∞:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ production

```typescript
// server/routes.ts (—Å—Ç—Ä–æ–∫–∏ 39-42)
if (!vapidPublicKey || !vapidPrivateKey) {
  console.warn('‚ö†Ô∏è VAPID keys not configured. Push notifications will not work.');
  // ‚ùå –¢–æ–ª—å–∫–æ warning - –Ω–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
  // ‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
}
```

#### –†–µ—à–µ–Ω–∏–µ:

```typescript
// server/routes.ts
if (!vapidPublicKey || !vapidPrivateKey) {
  if (process.env.NODE_ENV === 'production') {
    // ‚ùå –í production —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
    throw new Error('VAPID keys must be configured in production');
  } else {
    console.warn('‚ö†Ô∏è VAPID keys not configured. Push notifications disabled.');
  }
}
```

---

## ‚úÖ –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–´–ï –ê–°–ü–ï–ö–¢–´

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ - –û–¢–õ–ò–ß–ù–û ‚úÖ

**–û—Ü–µ–Ω–∫–∞:** üü¢ **–û–¢–õ–ò–ß–ù–û**

#### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **–ß–∏—Å—Ç–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ—ë–≤:**
```
client/          - Frontend (React + Wouter + TanStack Query)
server/          - Backend (Express + Drizzle ORM)
shared/          - –û–±—â–∏–µ —Ç–∏–ø—ã –∏ —Å—Ö–µ–º—ã (Zod)
```

2. **TypeScript –≤–µ–∑–¥–µ:**
   - –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
   - Zod —Å—Ö–µ–º—ã –¥–ª—è runtime –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - Type safety –º–µ–∂–¥—É frontend –∏ backend

3. **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫:**
   - ‚úÖ React —Å hooks
   - ‚úÖ Wouter –¥–ª—è —Ä–æ—É—Ç–∏–Ω–≥–∞ (–ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π)
   - ‚úÖ TanStack Query –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
   - ‚úÖ Drizzle ORM (type-safe, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π)
   - ‚úÖ Shadcn UI components

4. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å:**
   - –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
   - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
   - –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è storage, routes, schema

---

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - –•–û–†–û–®–û ‚úÖ

**–û—Ü–µ–Ω–∫–∞:** üü¢ **–•–û–†–û–®–û**

#### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ö–µ–º–∞:**
```typescript
// shared/schema.ts
// ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
// ‚úÖ Foreign keys —Å CASCADE DELETE
// ‚úÖ NOT NULL constraints –≥–¥–µ –Ω—É–∂–Ω–æ
// ‚úÖ Unique constraints (access codes, usernames)
```

2. **–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```typescript
// ‚úÖ B-tree –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ FK
senderIdx: index("messages_sender_id_idx").on(table.senderId)

// ‚úÖ GIN –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –º–∞—Å—Å–∏–≤—ã
recipientIdsIdx: index("messages_recipient_ids_idx").using("gin", table.recipientIds)

// ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ —Ñ–∏–ª—å—Ç—Ä—É–µ–º—ã–µ –ø–æ–ª—è
deletedIdx: index("messages_is_deleted_idx").on(table.isDeleted)
```

3. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:**
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è 3NF
   - –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π
   - –°–≤—è–∑–∏ many-to-many —á–µ—Ä–µ–∑ –º–∞—Å—Å–∏–≤—ã (PostgreSQL —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞)

4. **–ö–∞—Å–∫–∞–¥–Ω—ã–µ —É–¥–∞–ª–µ–Ω–∏—è:**
```typescript
// ‚úÖ –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ —É–¥–∞–ª—è—é—Ç—Å—è –µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è, –∑–∞–¥–∞–Ω–∏—è –∏ —Ç.–¥.
senderId: integer("sender_id").references(() => departments.id, { 
  onDelete: 'cascade' 
})
```

#### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ createdAt –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
createdAtIdx: index("messages_created_at_idx").on(table.createdAt)

// –î–æ–±–∞–≤–∏—Ç—å —á–∞—Å—Ç–∏—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
activeAssignmentsIdx: index("assignments_active_idx")
  .on(table.isCompleted, table.isDeleted)
  .where(sql`is_completed = false AND is_deleted = false`)
```

---

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö - –û–¢–õ–ò–ß–ù–û ‚úÖ

**–û—Ü–µ–Ω–∫–∞:** üü¢ **–û–¢–õ–ò–ß–ù–û**

```typescript
// ‚úÖ Zod —Å—Ö–µ–º—ã –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
export const insertMessageSchema = createInsertSchema(messages).omit({
  id: true,
  createdAt: true,
  // ...
}).extend({
  documentDate: z.coerce.date(),
  recipientIds: z.array(z.number()).min(1).optional(),
});

// ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ API endpoints
const validationResult = insertAssignmentSchema.safeParse(assignmentData);
if (!validationResult.success) {
  return res.status(400).json({ 
    error: 'Invalid request data', 
    details: validationResult.error.errors 
  });
}

// ‚úÖ –¢–∏–ø–∏–∑–∞—Ü–∏—è –∏–∑ —Å—Ö–µ–º
export type InsertMessage = z.infer<typeof insertMessageSchema>;
export type Message = typeof messages.$inferSelect;
```

---

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ - –•–û–†–û–®–û ‚úÖ

**–û—Ü–µ–Ω–∫–∞:** üü¢ **–•–û–†–û–®–û**

```typescript
// ‚úÖ Try-catch –±–ª–æ–∫–∏ –≤–µ–∑–¥–µ
try {
  const result = await storage.operation();
  res.json(result);
} catch (error: any) {
  console.error('Error:', error);
  res.status(500).json({ error: error.message });
}

// ‚úÖ –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫
if (!message) {
  return res.status(404).json({ error: 'Message not found' });
}

if (!hasPermission) {
  return res.status(403).json({ error: 'Access denied' });
}
```

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

```typescript
// –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
class AppError extends Error {
  constructor(
    public statusCode: number,
    message: string,
    public isOperational = true
  ) {
    super(message);
  }
}

// Error handling middleware
app.use((err: Error, req: Request, res: Response, next: NextFunction) => {
  if (err instanceof AppError) {
    return res.status(err.statusCode).json({
      error: err.message,
      ...(process.env.NODE_ENV === 'development' && { stack: err.stack })
    });
  }
  
  // Unexpected errors
  console.error('UNEXPECTED ERROR:', err);
  res.status(500).json({ 
    error: 'Internal server error' 
  });
});
```

---

### 5. Frontend –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –•–û–†–û–®–û ‚úÖ

**–û—Ü–µ–Ω–∫–∞:** üü¢ **–•–û–†–û–®–û**

1. **XSS –∑–∞—â–∏—Ç–∞:**
   - ‚úÖ –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `dangerouslySetInnerHTML`
   - ‚úÖ React –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç –≤—ã–≤–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º:**
```typescript
// ‚úÖ React Hook Form + Zod
const form = useForm({
  resolver: zodResolver(formSchema)
});

// ‚úÖ Client-side –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
if (!subject.trim()) {
  toast({ title: '–•–∞—Ç–æ', description: '–ú–∞–≤–∑—É—ä—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥' });
  return;
}
```

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤:**
```typescript
// ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
if (!file.type.startsWith('image/')) {
  toast({ description: '–¢–∞–Ω“≥–æ —Ñ–∞–π–ª“≥–æ–∏ —Ç–∞—Å–≤–∏—Ä”£ –º—É—Ç–∞–Ω–æ—Å–∏–±–∞–Ω–¥' });
  return;
}

// ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
if (file.size > 10 * 1024 * 1024) {
  toast({ description: '–ê–Ω–¥–æ–∑–∞–∏ —Ñ–∞–π–ª –∞–∑ 10 –ú–ë –∑–∏—ë–¥ –Ω–∞–±–æ—à–∞–¥' });
  return;
}
```

---

### 6. PWA –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - –û–¢–õ–ò–ß–ù–û ‚úÖ

**–û—Ü–µ–Ω–∫–∞:** üü¢ **–û–¢–õ–ò–ß–ù–û**

```typescript
// vite.config.ts
VitePWA({
  strategies: "injectManifest",         // ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
  registerType: "autoUpdate",           // ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  manifest: {
    name: "EcoDoc - –ú—É–±–æ–¥–∏–ª–∞–∏ —Ö–∞—Ç“≥–æ",  // ‚úÖ –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
    theme_color: "#4a9d4a",             // ‚úÖ –ë—Ä–µ–Ω–¥–∏–Ω–≥
    display: "standalone",               // ‚úÖ –ù–∞—Ç–∏–≤–Ω—ã–π –≤–∏–¥
    lang: "tg",                          // ‚úÖ –¢–∞–¥–∂–∏–∫—Å–∫–∏–π —è–∑—ã–∫
  },
  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
  maximumFileSizeToCacheInBytes: 3 * 1024 * 1024,
})
```

---

### 7. –ö–æ–¥–æ–≤–∞—è –±–∞–∑–∞ - –•–û–†–û–®–û ‚úÖ

**–û—Ü–µ–Ω–∫–∞:** üü¢ **–•–û–†–û–®–û**

1. **–ß–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å:**
   - ‚úÖ –û—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
   - ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É—á–∞—Å—Ç–∫–∞—Ö
   - ‚úÖ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –∫–æ–¥–∞

2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º/—Ç–∞–¥–∂–∏–∫—Å–∫–æ–º –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
   - ‚úÖ TypeDoc comments –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

3. **–ù–µ –Ω–∞–π–¥–µ–Ω–æ:**
   - ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
   - ‚úÖ –ù–µ—Ç dead code
   - ‚úÖ –ù–µ—Ç console.log (—Ç–æ–ª—å–∫–æ console.error –¥–ª—è –æ—à–∏–±–æ–∫)

---

## üîß –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ò –£–õ–£–ß–®–ï–ù–ò–Ø

### 1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ë–î - –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ üü°

#### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è N+1 –ø—Ä–æ–±–ª–µ–º–∞

```typescript
// server/storage.ts - getInboxMessages
// ‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
const messages = await db.select().from(messagesTable).where(...);

for (const message of messages) {
  const attachments = await db.select()
    .from(attachmentsTable)
    .where(eq(attachmentsTable.messageId, message.id));
}
```

#### –†–µ—à–µ–Ω–∏–µ:

```typescript
// –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å—ë –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º —Å JOIN
const messagesWithAttachments = await db
  .select({
    message: messagesTable,
    attachment: attachmentsTable,
  })
  .from(messagesTable)
  .leftJoin(
    attachmentsTable,
    eq(attachmentsTable.messageId, messagesTable.id)
  )
  .where(...);

// –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Drizzle relations
const messagesWithAttachments = await db.query.messages.findMany({
  where: ...,
  with: {
    attachments: true,
  },
});
```

---

### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ - –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

```typescript
// –ö—ç—à –¥–ª—è —Å–ø–∏—Å–∫–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ (—Ä–µ–¥–∫–æ –º–µ–Ω—è–µ—Ç—Å—è)
import NodeCache from 'node-cache';
const cache = new NodeCache({ stdTTL: 3600 }); // 1 —á–∞—Å

app.get("/api/departments", async (req, res) => {
  const cacheKey = 'departments:all';
  const cached = cache.get(cacheKey);
  
  if (cached) {
    return res.json(cached);
  }
  
  const departments = await storage.getAllDepartments();
  cache.set(cacheKey, departments);
  res.json(departments);
});

// –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
app.patch("/api/departments/:id", requireAdmin, async (req, res) => {
  // ...
  cache.del('departments:all');
  // ...
});
```

---

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ - –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å winston –≤–º–µ—Å—Ç–æ console.log
import winston from 'winston';

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' }),
  ],
});

// –í production –¥–æ–±–∞–≤–∏—Ç—å external logging (Sentry, LogRocket)
if (process.env.NODE_ENV === 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.simple(),
  }));
}
```

---

## üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô –ü–û –ü–†–ò–û–†–ò–¢–ï–¢–ê–ú

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–ë–ª–æ–∫–µ—Ä—ã production)

**–°—Ä–æ–∫–∏: 1-2 –¥–Ω—è**

1. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å CSRF –∑–∞—â–∏—Ç—É**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `csurf` –ø–∞–∫–µ—Ç
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CSRF middleware
   - –û–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

2. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤**
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É MIME —á–µ—Ä–µ–∑ file-type
   - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤
   - –°–Ω–∏–∑–∏—Ç—å –ª–∏–º–∏—Ç –¥–æ 10MB
   - –î–æ–±–∞–≤–∏—Ç—å whitelist —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π

3. ‚úÖ **–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å CORS**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å allowed origins
   - –ò–∑–º–µ–Ω–∏—Ç—å sameSite –Ω–∞ strict/lax
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:** –ü—Ä–æ–π—Ç–∏ security audit, –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

---

### üü° –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–ü–µ—Ä–µ–¥ production)

**–°—Ä–æ–∫–∏: 2-3 –¥–Ω—è**

4. ‚úÖ **Rate limiting –∏ brute-force –∑–∞—â–∏—Ç–∞**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å express-rate-limit
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–∏–º–∏—Ç—ã –¥–ª—è login endpoints
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

5. ‚úÖ **–£–ª—É—á—à–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏**
   - –°–æ–∫—Ä–∞—Ç–∏—Ç—å —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ –¥–æ 7 –¥–Ω–µ–π
   - –î–æ–±–∞–≤–∏—Ç—å idle timeout
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–æ—Ç–∞—Ü–∏—é —Å–µ—Å—Å–∏–∏

6. ‚úÖ **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ VAPID –∫–ª—é—á–∏ –≤ production**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è VAPID –∫–ª—é—á–µ–π
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ env variables
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–ª–∏—á–∏—è –≤ production

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:** –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫ brute-force, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–µ—Å—Å–∏–∏

---

### üü¢ –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–ü–æ—Å–ª–µ production)

**–°—Ä–æ–∫–∏: 1 –Ω–µ–¥–µ–ª—è**

7. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å N+1 –ø—Ä–æ–±–ª–µ–º—ã
   - –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

8. ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å winston
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–æ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

9. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å health-check endpoint
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ production errors
   - Email/SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞

---

### üîµ –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–£–ª—É—á—à–µ–Ω–∏—è)

**–°—Ä–æ–∫–∏: 2-4 –Ω–µ–¥–µ–ª–∏**

10. ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
    - Redis –¥–ª—è session store
    - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤
    - HTTP –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏

11. ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
    - Unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–∏
    - Integration —Ç–µ—Å—Ç—ã –¥–ª—è API
    - E2E —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

12. ‚úÖ **–ê–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤**
    - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ClamAV –∏–ª–∏ VirusTotal API
    - –ö–∞—Ä–∞–Ω—Ç–∏–Ω –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:** –í—ã—Å–æ–∫–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

---

## üìä –ú–ï–¢–†–ò–ö–ò –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|---------|----------|--------|
| TypeScript –ø–æ–∫—Ä—ã—Ç–∏–µ | ~95% | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `any` | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ | ‚úÖ –•–æ—Ä–æ—à–æ |
| –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö | –í–µ–∑–¥–µ (Zod) | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | –í–µ–∑–¥–µ | ‚úÖ –•–æ—Ä–æ—à–æ |
| –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ | ‚úÖ –•–æ—Ä–æ—à–æ |

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ç—É—Å | –û—Ü–µ–Ω–∫–∞ |
|--------|--------|--------|
| CSRF –∑–∞—â–∏—Ç–∞ | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| XSS –∑–∞—â–∏—Ç–∞ | ‚úÖ React –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è | ‚úÖ –•–æ—Ä–æ—à–æ |
| SQL Injection | ‚úÖ ORM –∑–∞—â–∏—Ç–∞ | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| Rate limiting | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | üü° –°—Ä–µ–¥–Ω–∏–π |
| Session security | ‚ö†Ô∏è –ë–∞–∑–æ–≤–∞—è | üü° –°—Ä–µ–¥–Ω–∏–π |

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|---------|----------|--------|
| –ò–Ω–¥–µ–∫—Å—ã | 13 –∏–Ω–¥–µ–∫—Å–æ–≤ | ‚úÖ –•–æ—Ä–æ—à–æ |
| –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è | 3NF | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| Foreign keys | –í–µ–∑–¥–µ —Å CASCADE | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| Constraints | NOT NULL, UNIQUE | ‚úÖ –•–æ—Ä–æ—à–æ |

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

| –ú–µ—Ç—Ä–∏–∫–∞ | –°—Ç–∞—Ç—É—Å | –û—Ü–µ–Ω–∫–∞ |
|---------|--------|--------|
| N+1 –∑–∞–ø—Ä–æ—Å—ã | ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –µ—Å—Ç—å | üü° –°—Ä–µ–¥–Ω–∏–π |
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è | ‚úÖ –•–æ—Ä–æ—à–∞—è | ‚úÖ –•–æ—Ä–æ—à–æ |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | üü° –°—Ä–µ–¥–Ω–∏–π |
| Bundle size | –°—Ä–µ–¥–Ω–∏–π | ‚úÖ –ù–æ—Ä–º–∞ |

---

## üéØ –§–ò–ù–ê–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ë–ª–æ–∫–µ—Ä—ã –¥–ª—è production:

1. **–ö—Ä–∏—Ç–∏—á–Ω–æ:** –î–æ–±–∞–≤–∏—Ç—å CSRF –∑–∞—â–∏—Ç—É (–î–û–õ–ñ–ù–û –±—ã—Ç—å —Å–¥–µ–ª–∞–Ω–æ)
2. **–ö—Ä–∏—Ç–∏—á–Ω–æ:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ñ–∞–π–ª–æ–≤ (–î–û–õ–ñ–ù–û –±—ã—Ç—å —Å–¥–µ–ª–∞–Ω–æ)
3. **–ö—Ä–∏—Ç–∏—á–Ω–æ:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å CORS –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤

### –í–∞–∂–Ω–æ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:

4. –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è login endpoints
5. –£–ª—É—á—à–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å VAPID –∫–ª—é—á–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –≤ production

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

7. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î –∑–∞–ø—Ä–æ—Å—ã
8. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
9. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
10. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

---

## üìû –ö–û–ù–¢–†–û–õ–¨–ù–´–ô –°–ü–ò–°–û–ö –î–õ–Ø –†–ï–õ–ò–ó–ê

- [ ] ‚úÖ CSRF –∑–∞—â–∏—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞
- [ ] ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ file-type
- [ ] ‚úÖ CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- [ ] ‚úÖ Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] ‚úÖ –°–µ—Å—Å–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã (short lifetime, rotation)
- [ ] ‚úÖ VAPID –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] ‚úÖ Monitoring –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] ‚úÖ Health-check endpoint —Å–æ–∑–¥–∞–Ω
- [ ] ‚úÖ Backup –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] ‚úÖ Production environment variables –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] ‚úÖ –ü—Ä–æ–≤–µ–¥—ë–Ω penetration testing
- [ ] ‚úÖ –ü—Ä–æ–≤–µ–¥—ë–Ω load testing

---

## üîç –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

EcoDoc - —ç—Ç–æ **—Ö–æ—Ä–æ—à–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º. –û–¥–Ω–∞–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**, –∫–æ—Ç–æ—Ä—ã–µ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ø–µ—Ä–µ–¥ production –∑–∞–ø—É—Å–∫–æ–º.

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã:**

‚úÖ **–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- –û—Ç–ª–∏—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞
- –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –•–æ—Ä–æ—à–∞—è —Å—Ö–µ–º–∞ –ë–î —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- CSRF —É—è–∑–≤–∏–º–æ—Å—Ç—å (origin: true + credentials: true + sameSite: none)
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting

**–ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** 

> ‚ö†Ô∏è **–ù–ï –ó–ê–ü–£–°–ö–ê–¢–¨ –í PRODUCTION** –¥–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.  
> –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è CSRF –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤ - —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

**–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –¥–æ production-ready:** 3-5 –¥–Ω–µ–π –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á–∞—Ö.

---

**–ê—É–¥–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω:** Replit Agent  
**–î–∞—Ç–∞:** 24 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è –æ—Ç—á—ë—Ç–∞:** 1.0.0
