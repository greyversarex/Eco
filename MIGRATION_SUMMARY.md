# –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Supabase Storage - –ö—Ä–∞—Ç–∫–∞—è –°–≤–æ–¥–∫–∞

## üéØ –ß—Ç–æ –ë—ã–ª–æ –°–¥–µ–ª–∞–Ω–æ

–ü—Ä–æ–µ–∫—Ç **–≠–∫–æ–¢–æ—á–∏–∫–∏—Å—Ç–æ–Ω** —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Replit Object Storage (Google Cloud Storage) –Ω–∞ **Supabase Storage** –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –Ω–∞ production VDS-—Å–µ—Ä–≤–µ—Ä–µ.

---

## üìù –°–ø–∏—Å–æ–∫ –ò–∑–º–µ–Ω–µ–Ω–∏–π

### 1. Backend –ò–∑–º–µ–Ω–µ–Ω–∏—è

#### ‚úÖ **server/objectStorage.ts** - –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å Hybrid Storage
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞** –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `@google-cloud/storage` –¥–ª—è legacy –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- **–î–æ–±–∞–≤–ª–µ–Ω–∞** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `@supabase/storage-js` –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ hybrid –ª–æ–≥–∏–∫–∞:**
  - –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã (uploads/*) ‚Üí Supabase Storage
  - Legacy —Ñ–∞–π–ª—ã (replit-objstore-*) ‚Üí Google Cloud Storage (–µ—Å–ª–∏ PRIVATE_OBJECT_DIR —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ –ø–æ URL –ø–∞—Ç—Ç–µ—Ä–Ω—É
- **–ú–µ—Ç–æ–¥—ã —Å dual –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:**
  - `getObjectEntityUploadURL()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è presigned URL (—Ç–æ–ª—å–∫–æ Supabase –¥–ª—è –Ω–æ–≤—ã—Ö)
  - `getObjectEntityDownloadURL()` - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ —Ç–∏–ø–∞ storage
  - `downloadObject()` - –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ –ª—é–±–æ–≥–æ storage
  - `getObjectEntityFile()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–π–ª –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ storage
  - `normalizeObjectEntityPath()` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–µ–π –¥–ª—è –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
  - `trySetObjectEntityAclPolicy()` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ ACL –¥–ª—è –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤
- **–ù–æ–≤—ã–π error type:** `LegacyFileUnavailableError` - –∫–æ–≥–¥–∞ legacy —Ñ–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ production

#### ‚úÖ **server/objectAcl.ts** - Hybrid –≤–µ—Ä—Å–∏—è
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞** –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Google Cloud Storage File type –¥–ª—è legacy
- **–î–æ–±–∞–≤–ª–µ–Ω—ã** —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Google Cloud Storage ACL:
  - `setObjectAclPolicy()` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ ACL –¥–ª—è GCS File
  - `getObjectAclPolicy()` - –ø–æ–ª—É—á–µ–Ω–∏–µ ACL –∏–∑ GCS File
  - `canAccessObject()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ —Ç–∏–ø–∞)

#### ‚úÖ **server/routes.ts** - –û–±–Ω–æ–≤–ª–µ–Ω
- –£–¥–∞–ª–µ–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç `ObjectPermission`
- –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã endpoints –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º ObjectStorageService
- –í—Å–µ API endpoints –æ—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

### 2. Frontend –ò–∑–º–µ–Ω–µ–Ω–∏—è

#### ‚úÖ **client/src/components/ObjectUploader.tsx** - –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π!
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Supabase "–∏–∑ –∫–æ—Ä–æ–±–∫–∏"
- Presigned URL –º–µ—Ö–∞–Ω–∏–∑–º —Å–æ–≤–º–µ—Å—Ç–∏–º
- –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

#### ‚úÖ **client/src/pages/MessageView.tsx** - –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π!
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Ç–µ –∂–µ API endpoints
- Blob API –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
- –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### 3. Package Dependencies

#### ‚ûï **–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- `@supabase/storage-js` - Supabase Storage SDK (–¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤)

#### ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ:**
- `@google-cloud/storage` - Google Cloud Storage SDK (–¥–ª—è legacy —Ñ–∞–π–ª–æ–≤)

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### ‚úÖ **–ù–æ–≤—ã–µ Environment Variables:**

**Production (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):**
```bash
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
SUPABASE_STORAGE_BUCKET=ecotajikistan-files
```

**Development (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Replit):**
```bash
PRIVATE_OBJECT_DIR=replit-objstore-xxx  # –î–ª—è Replit Object Storage
```

#### ‚úÖ **–ù–æ–≤—ã–µ –§–∞–π–ª—ã:**
- `.env.example` - –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è production
- `PRODUCTION_DEPLOYMENT.md` - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- `MIGRATION_SUMMARY.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª

---

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

### –î–æ (Replit Object Storage)

```
Frontend ‚Üí Backend ‚Üí Replit Sidecar ‚Üí Google Cloud Storage
```

### –ü–æ—Å–ª–µ (Hybrid Storage)

```
                    ‚îå‚îÄ NEW FILES ‚îÄ‚Üí Supabase Storage
Frontend ‚Üí Backend ‚îÄ‚î§
                    ‚îî‚îÄ LEGACY FILES ‚îÄ‚Üí Replit Object Storage (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–º VDS-—Å–µ—Ä–≤–µ—Ä–µ (–Ω–µ —Ç–æ–ª—å–∫–æ Replit)
- ‚úÖ **–ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å legacy —Ñ–∞–π–ª–∞–º–∏ –Ω–∞ Replit**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
- ‚úÖ –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ Supabase API –±–µ–∑ –ø—Ä–æ–∫—Å–∏
- ‚úÖ Graceful degradation –Ω–∞ production (–ø–æ–Ω—è—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –¥–ª—è legacy —Ñ–∞–π–ª–æ–≤)
- ‚úÖ Professional-grade storage —Å SLA –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | Replit Storage | Supabase Storage | –°—Ç–∞—Ç—É—Å |
|---------|---------------|------------------|--------|
| –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ | ‚úÖ | ‚úÖ | **–†–∞–±–æ—Ç–∞–µ—Ç** |
| –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ | ‚úÖ | ‚úÖ | **–†–∞–±–æ—Ç–∞–µ—Ç** |
| –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è | ‚úÖ | ‚úÖ | **–†–∞–±–æ—Ç–∞–µ—Ç** |
| –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∑–∞–≥—Ä—É–∑–∫–∏ | ‚úÖ | ‚úÖ | **–†–∞–±–æ—Ç–∞–µ—Ç** |
| ACL –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ | ‚úÖ | ‚úÖ | **–†–∞–±–æ—Ç–∞–µ—Ç** |
| –†–∞–±–æ—Ç–∞ –Ω–∞ VDS | ‚ùå | ‚úÖ | **–£–ª—É—á—à–µ–Ω–æ** |
| –ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | ‚ö†Ô∏è | ‚úÖ | **–£–ª—É—á—à–µ–Ω–æ** |

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ß—Ç–æ –ù–ï –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:
- ‚úÖ –§–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏
- ‚úÖ –î–æ—Å—Ç—É–ø –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ message authorization
- ‚úÖ Presigned URLs —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è (15 –º–∏–Ω –¥–ª—è upload, 1 —á–∞—Å –¥–ª—è download)

### –ß—Ç–æ —É–ª—É—á—à–∏–ª–æ—Å—å:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Service Role Key –≤–º–µ—Å—Ç–æ Replit Sidecar
- ‚úÖ –ü—Ä—è–º–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ bucket policies –≤ Supabase
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Row Level Security (RLS)

---

## üì¶ –û–±—Ä–∞—Ç–Ω–∞—è –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –°–æ–≤–º–µ—Å—Ç–∏–º–æ:

1. **–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** - –ù–ï –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
   - –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - Legacy –ø–æ–ª—è (`attachmentUrl`, `attachmentName`) —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
   - –ù–æ–≤—ã–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `attachments` jsonb array

2. **API Endpoints** - –ù–ï –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
   - `POST /api/objects/upload`
   - `POST /api/objects/download`
   - `POST /api/messages/:id/attachment`
   - –í—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

3. **Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** - –ù–ï –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
   - ObjectUploader.tsx
   - MessageView.tsx
   - ComposeMessage.tsx

### ‚ö†Ô∏è Legacy –§–∞–π–ª—ã - –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ –°—Ä–µ–¥–µ:

**Development (Replit —Å PRIVATE_OBJECT_DIR):**
- ‚úÖ –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã **–î–û–°–¢–£–ü–ù–´** —á–µ—Ä–µ–∑ Replit Object Storage
- ‚úÖ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ Supabase Storage
- ‚úÖ –û–±–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**Production (VDS –±–µ–∑ PRIVATE_OBJECT_DIR):**
- ‚ùå –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã **–ù–ï–î–û–°–¢–£–ü–ù–´** (LegacyFileUnavailableError)
- ‚úÖ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ Supabase Storage
- ‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

**–ú–∏–≥—Ä–∞—Ü–∏—è legacy —Ñ–∞–π–ª–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
1. –ù–∞ Replit: —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏—Ö –≤ Supabase Storage
3. –û–±–Ω–æ–≤–∏—Ç–µ URL –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–∑–∞–º–µ–Ω–∏—Ç—å `/objects/replit-objstore-*/` –Ω–∞ `/objects/uploads/*`)

---

## üöÄ –ß—Ç–æ –ù—É–∂–Ω–æ –°–¥–µ–ª–∞—Ç—å –¥–ª—è Deployment

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å Supabase –ü—Ä–æ–µ–∫—Ç

1. –ó–∞–π—Ç–∏ –Ω–∞ https://supabase.com
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
3. –°–æ–∑–¥–∞—Ç—å bucket `ecotajikistan-files` (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π)
4. –ü–æ–ª—É—á–∏—Ç—å credentials:
   - Project URL
   - Service Role Key

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å –ö–æ–¥ –Ω–∞ –°–µ—Ä–≤–µ—Ä–µ

```bash
cd /var/www/ecotajikistan
git pull origin main
npm install
nano .env  # –î–æ–±–∞–≤–∏—Ç—å Supabase –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
npm run build
pm2 restart ecotajikistan
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –†–∞–±–æ—Ç—É

1. –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å 2-3 —Ñ–∞–π–ª–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ–∞–π–ª—ã –ø–æ—è–≤–∏–ª–∏—Å—å –≤ Supabase Storage
5. –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª—ã –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è

**–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**: —Å–º. `PRODUCTION_DEPLOYMENT.md`

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è Deployment

### –ü–µ—Ä–µ–¥ –ú–∏–≥—Ä–∞—Ü–∏–µ–π:
- [ ] –°–æ–∑–¥–∞–Ω Supabase –ø—Ä–æ–µ–∫—Ç
- [ ] –°–æ–∑–¥–∞–Ω bucket `ecotajikistan-files`
- [ ] –ü–æ–ª—É—á–µ–Ω—ã SUPABASE_URL –∏ SUPABASE_SERVICE_ROLE_KEY
- [ ] –°–¥–µ–ª–∞–Ω backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –°–¥–µ–ª–∞–Ω backup .env —Ñ–∞–π–ª–∞

### –í–æ –í—Ä–µ–º—è –ú–∏–≥—Ä–∞—Ü–∏–∏:
- [ ] –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω —Å GitHub
- [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`npm install`)
- [ ] .env —Ñ–∞–π–ª –æ–±–Ω–æ–≤–ª–µ–Ω —Å Supabase credentials
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–±—Ä–∞–Ω–æ (`npm run build`)
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ (PM2/systemd)

### –ü–æ—Å–ª–µ –ú–∏–≥—Ä–∞—Ü–∏–∏:
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ú–æ–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
- [ ] –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- [ ] –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä)
- [ ] –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Supabase Storage
- [ ] –§–∞–π–ª—ã –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

---

## üîß Troubleshooting

### "SUPABASE_URL not set"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
nano .env
# –î–æ–±–∞–≤–∏—Ç—å: SUPABASE_URL=https://xxx.supabase.co
pm2 restart ecotajikistan
```

### –§–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. Service Role Key –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π? (–Ω–µ anon key!)
2. Bucket `ecotajikistan-files` —Å–æ–∑–¥–∞–Ω?
3. –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å –æ—à–∏–±–∫–∏ Supabase?

```bash
pm2 logs ecotajikistan | grep -i "supabase\|upload\|error"
```

### –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –Ω–µ —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è

**–≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ!**

–°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –∏–∑ Replit Storage –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏.
–ï—Å–ª–∏ –æ–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã - —Å–¥–µ–ª–∞–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π.

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **PRODUCTION_DEPLOYMENT.md** - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é (60+ —Å—Ç—Ä–∞–Ω–∏—Ü)
- **.env.example** - –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ environment variables
- **replit.md** - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)

---

## ‚úÖ –†–µ–∑—é–º–µ

### –ß—Ç–æ –ü–æ–ª—É—á–∏–ª–∏:

1. **Production-Ready –†–µ—à–µ–Ω–∏–µ**
   - –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–º VDS-—Å–µ—Ä–≤–µ—Ä–µ
   - –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Replit –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

2. **–ù–∞–¥–µ–∂–Ω–æ–µ –•—Ä–∞–Ω–∏–ª–∏—â–µ**
   - Supabase Storage —Å enterprise-grade SLA
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ backup'—ã
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –ü–æ–¥–¥–µ—Ä–∂–∫–∏**
   - –ü–æ–Ω—è—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
   - –õ–µ–≥–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
   - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

4. **–û–±—Ä–∞—Ç–Ω–∞—è –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
   - –ù—É–ª–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î
   - –ù—É–ª–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ API
   - –ù—É–ª–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

### –í—Ä–µ–º—è –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

- **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Supabase**: 10 –º–∏–Ω—É—Ç
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞**: 10 –º–∏–Ω—É—Ç
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: 10 –º–∏–Ω—É—Ç
- **–ò–¢–û–ì–û**: ~30 –º–∏–Ω—É—Ç

### –í—Ä–µ–º—è –ü—Ä–æ—Å—Ç–æ—è:

- **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ‚Üí –ó–∞–ø—É—Å–∫**: ~5 –º–∏–Ω—É—Ç

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

1. **–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ** `PRODUCTION_DEPLOYMENT.md`
2. **–°–æ–∑–¥–∞–π—Ç–µ** Supabase –ø—Ä–æ–µ–∫—Ç
3. **–û–±–Ω–æ–≤–∏—Ç–µ** .env —Ñ–∞–π–ª
4. **–†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ** –Ω–∞ production-—Å–µ—Ä–≤–µ—Ä–µ
5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
6. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ** –ø–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞

**–ì–æ—Ç–æ–≤–æ –∫ deployment!** ‚úÖ

---

**–î–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏**: $(date +%Y-%m-%d)  
**–í–µ—Ä—Å–∏—è**: 2.0 (Supabase Storage)  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ Production
