# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –û–±–Ω–æ–≤–ª–µ–Ω–∏—é –≠–∫–æ–¢–æ—á–∏–∫–∏—Å—Ç–æ–Ω v2.0
## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –§–∞–π–ª–æ–≤—ã—Ö –í–ª–æ–∂–µ–Ω–∏–π

---

## üìã 1. –ö–†–ê–¢–ö–ò–ô –°–ü–ò–°–û–ö –ò–ó–ú–ï–ù–ï–ù–ò–ô

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ 5 —Ñ–∞–π–ª–æ–≤ –Ω–∞ –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞: 100 –ú–ë
   - –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Cloud Storage**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —á–µ—Ä–µ–∑ presigned URLs
   - –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å ACL-–ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫

3. **–£–ª—É—á—à–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤**
   - –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ObjectUploader
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Drag & Drop
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏
   - –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏

4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤**
   - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å CORS –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏
   - –§–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Blob API
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤

5. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
   - –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–¥–Ω–∏–º –≤–ª–æ–∂–µ–Ω–∏–µ–º –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã legacy-–ø–æ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (attachmentUrl, attachmentName)

---

## üì¶ 2. –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ó–ê–í–ò–°–ò–ú–û–°–¢–Ø–• –ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò

### 2.1 –ù–æ–≤—ã–µ NPM-–ø–∞–∫–µ—Ç—ã

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏:**

```json
{
  "@google-cloud/storage": "^7.17.2",
  "@uppy/core": "^5.1.1",
  "@uppy/dashboard": "^5.0.3",
  "@uppy/react": "^5.1.0",
  "@uppy/aws-s3": "^5.0.2",
  "sharp": "^0.34.4"
}
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í—Å–µ —ç—Ç–∏ –ø–∞–∫–µ—Ç—ã –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `npm install` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

### 2.2 –ù–æ–≤—ã–µ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –û–∫—Ä—É–∂–µ–Ω–∏—è (.env)

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ –≤–∞—à `.env` —Ñ–∞–π–ª –Ω–∞ production-—Å–µ—Ä–≤–µ—Ä–µ:

```bash
PRIVATE_OBJECT_DIR=replit-objstore-dd97d272-777b-4338-bf8c-2e0918ffb888
```

**–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

```bash
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
DATABASE_URL=postgresql://user:password@host:port/database

# –°–µ—Å—Å–∏–∏
SESSION_SECRET=–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á_–¥–ª—è_—Å–µ—Å—Å–∏–π

# –û–∫—Ä—É–∂–µ–Ω–∏–µ
NODE_ENV=production

# Google Cloud Storage (–ù–û–í–ê–Ø –ü–ï–†–ï–ú–ï–ù–ù–ê–Ø!)
PRIVATE_OBJECT_DIR=replit-objstore-dd97d272-777b-4338-bf8c-2e0918ffb888
```

> **‚ö†Ô∏è –í–ê–ñ–ù–û:** –ë–µ–∑ `PRIVATE_OBJECT_DIR` –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞—Ç—å –ù–ï –ë–£–î–£–¢!

---

## üóÑÔ∏è 3. –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ë–ê–ó–ï –î–ê–ù–ù–´–•

### 3.1 –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ö–µ–º–µ

**–¢–∞–±–ª–∏—Ü–∞ `messages` - –î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ –ø–æ–ª–µ:**

```sql
-- –ù–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–ª–æ–∂–µ–Ω–∏–π
attachments JSONB
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–æ–ª–µ `attachments`:**
```json
[
  {
    "url": "https://storage.googleapis.com/.../filename1.pdf",
    "name": "–û—Ç—á–µ—Ç_2024.pdf"
  },
  {
    "url": "https://storage.googleapis.com/.../filename2.jpg",
    "name": "–§–æ—Ç–æ_1.jpg"
  }
]
```

### 3.2 –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**–°–æ—Ö—Ä–∞–Ω–µ–Ω—ã legacy-–ø–æ–ª—è** (–¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π):
- `attachment_url` (text)
- `attachment_name` (text)

–°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π!

### 3.3 –ö–æ–º–∞–Ω–¥–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

**–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:**

```bash
npm run db:push
```

**–ï—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö** (data-loss warning):

```bash
npm run db:push -- --force
```

> **‚úÖ –ì–ê–†–ê–ù–¢–ò–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:** –ö–æ–º–∞–Ω–¥–∞ `db:push --force` **–ù–ï –£–î–ê–õ–Ø–ï–¢** —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –û–Ω–∞ —Ç–æ–ª—å–∫–æ **–î–û–ë–ê–í–õ–Ø–ï–¢** –Ω–æ–≤–æ–µ –ø–æ–ª–µ `attachments` –∫ —Ç–∞–±–ª–∏—Ü–µ `messages`. –í—Å–µ –≤–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è, –æ—Ç–¥–µ–ª—ã –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏.

---

## üöÄ 4. –ü–û–®–ê–ì–û–í–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –û–ë–ù–û–í–õ–ï–ù–ò–Æ –°–ï–†–í–ï–†–ê

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞

**–ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (Replit):**

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –≤ Git
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–¥ –Ω–∞ GitHub:
   ```bash
   git add .
   git commit -m "–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö –≤–ª–æ–∂–µ–Ω–∏–π v2.0"
   git push origin main
   ```

---

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ VDS-—Å–µ—Ä–≤–µ—Ä–µ (Ubuntu 22.04, TimeWeb)

**–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ SSH:**

```bash
ssh –≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å@–≤–∞—à_—Å–µ—Ä–≤–µ—Ä_ip
```

---

#### –®–ê–ì 1: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/your/project

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PM2 –ø—Ä–æ—Ü–µ—Å—Å (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ PM2)
pm2 stop ecosystem.config.js
# –ò–õ–ò –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ systemd:
# sudo systemctl stop ecotajikistan
```

---

#### –®–ê–ì 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!)

```bash
# –°–æ–∑–¥–∞–π—Ç–µ backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
pg_dump -U –≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å_–±–¥ -d –≤–∞—à–∞_–±–∞–∑–∞_–¥–∞–Ω–Ω—ã—Ö -F c -f ~/backup_ecotajikistan_$(date +%Y%m%d_%H%M%S).dump

# –°–æ–∑–¥–∞–π—Ç–µ backup —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
cp -r /path/to/your/project ~/backup_project_$(date +%Y%m%d_%H%M%S)
```

> **‚ö†Ô∏è –ù–ï –ü–†–û–ü–£–°–ö–ê–ô–¢–ï –≠–¢–û–¢ –®–ê–ì!** –í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º –≤—ã —Å–º–æ–∂–µ—Ç–µ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞–∑–∞–¥.

---

#### –®–ê–ì 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ —Å GitHub

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/your/project

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
git stash

# –ü–æ–ª—É—á–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å GitHub
git pull origin main

# –ï—Å–ª–∏ –±—ã–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –≤–µ—Ä–Ω–∏—Ç–µ –∏—Ö
# git stash pop
```

---

#### –®–ê–ì 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—ã–µ npm-–ø–∞–∫–µ—Ç—ã
npm install

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
npm list @google-cloud/storage
npm list @uppy/core
```

---

#### –®–ê–ì 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª
nano .env

# –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é (–µ—Å–ª–∏ –µ—ë –Ω–µ—Ç):
# PRIVATE_OBJECT_DIR=replit-objstore-dd97d272-777b-4338-bf8c-2e0918ffb888

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª: Ctrl+O, Enter, Ctrl+X
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

```bash
cat .env | grep -E "DATABASE_URL|SESSION_SECRET|NODE_ENV|PRIVATE_OBJECT_DIR"
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ 4 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ!

---

#### –®–ê–ì 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
npm run db:push
```

**–ï—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:**

```
‚ö†Ô∏è We found changes affecting the data, review them carefully:
...
```

**–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å —Ñ–ª–∞–≥–æ–º --force:**

```bash
npm run db:push -- --force
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ:**

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã messages
psql -U –≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å_–±–¥ -d –≤–∞—à–∞_–±–∞–∑–∞_–¥–∞–Ω–Ω—ã—Ö -c "\d messages"
```

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–æ–ª–æ–Ω–∫–∞ `attachments` —Ç–∏–ø–∞ `jsonb`.

---

#### –®–ê–ì 7: –°–±–æ—Ä–∫–∞ production-–≤–µ—Ä—Å–∏–∏

```bash
# –°–æ–±–µ—Ä–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –±—ç–∫–µ–Ω–¥
npm run build
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞:**

```bash
ls -la dist/
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–∞–π–ª—ã: index.js, client/ –∏ –¥—Ä—É–≥–∏–µ
```

---

#### –®–ê–ì 8: –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ PM2
pm2 start ecosystem.config.js

# –ò–õ–ò —á–µ—Ä–µ–∑ systemd:
# sudo systemctl start ecotajikistan

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
pm2 status
# –ò–õ–ò
# sudo systemctl status ecotajikistan
```

---

#### –®–ê–ì 9: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
pm2 logs --lines 50

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: "Server running on port 5000" –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ
```

---

#### –®–ê–ì 10: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

**–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:**

1. ‚úÖ –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. ‚úÖ –°—Ç–∞—Ä—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å
4. ‚úÖ –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
5. ‚úÖ –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ (–¥–æ 5 —à—Ç—É–∫)
6. ‚úÖ –§–∞–π–ª—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
7. ‚úÖ –§–∞–π–ª—ã –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å

---

## üîç 5. –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–†–û–ë–õ–ï–ú

### –ü—Ä–æ–±–ª–µ–º–∞: –§–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo $PRIVATE_OBJECT_DIR

# –ï—Å–ª–∏ –ø—É—Å—Ç–æ, –¥–æ–±–∞–≤—å—Ç–µ –≤ .env –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
pm2 restart ecosystem.config.js
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ --force
npm run db:push -- --force

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
psql -U –≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å_–±–¥ -d –≤–∞—à–∞_–±–∞–∑–∞_–¥–∞–Ω–Ω—ã—Ö -c "SELECT version();"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ legacy-–ø–æ–ª—è –Ω–µ —É–¥–∞–ª–µ–Ω—ã
psql -U –≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å_–±–¥ -d –≤–∞—à–∞_–±–∞–∑–∞_–¥–∞–Ω–Ω—ã—Ö -c "\d messages" | grep attachment
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å: `attachment_url`, `attachment_name`, `attachments`

### –ü—Ä–æ–±–ª–µ–º–∞: npm install –Ω–µ –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à
npm cache clean --force

# –£–¥–∞–ª–∏—Ç–µ node_modules –∏ package-lock.json
rm -rf node_modules package-lock.json

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
npm install
```

---

## üéØ 6. –ö–û–ù–¢–†–û–õ–¨–ù–´–ô –ß–ï–ö–õ–ò–°–¢ –ü–û–°–õ–ï –û–ë–ù–û–í–õ–ï–ù–ò–Ø

- [ ] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–º–µ–µ—Ç –Ω–æ–≤–æ–µ –ø–æ–ª–µ `attachments`
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `PRIVATE_OBJECT_DIR` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ `.env`
- [ ] –í—Å–µ npm-–ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`npm list` –±–µ–∑ –æ—à–∏–±–æ–∫)
- [ ] –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°—Ç–∞—Ä—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å
- [ ] –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏
- [ ] –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ Google Cloud Storage
- [ ] –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å
- [ ] –õ–æ–≥–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

---

## üîÑ 7. –û–¢–ö–ê–¢ –ò–ó–ú–ï–ù–ï–ù–ò–ô (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

### –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 stop all

# 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –∏–∑ backup
rm -rf /path/to/your/project
cp -r ~/backup_project_–î–ê–¢–ê /path/to/your/project
cd /path/to/your/project

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
pg_restore -U –≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å_–±–¥ -d –≤–∞—à–∞_–±–∞–∑–∞_–¥–∞–Ω–Ω—ã—Ö -c ~/backup_ecotajikistan_–î–ê–¢–ê.dump

# 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 start ecosystem.config.js
```

---

## üìû 8. –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ü–û–î–î–ï–†–ñ–ö–ê

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `pm2 logs`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ë–î: `sudo systemctl status postgresql`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `cat .env`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã: `sudo netstat -tulpn | grep LISTEN`

---

## üìä 9. –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò –î–õ–Ø –°–ü–†–ê–í–ö–ò

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏):

**Backend:**
- `server/routes.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Å—Å–∏–≤–∞ attachments
- `server/objectStorage.ts` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Cloud Storage
- `server/objectAcl.ts` - –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
- `shared/schema.ts` - –Ω–æ–≤–æ–µ –ø–æ–ª–µ `attachments` –≤ —Å—Ö–µ–º–µ –ë–î

**Frontend:**
- `client/src/components/ObjectUploader.tsx` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω
- `client/src/pages/ComposeMessage.tsx` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- `client/src/pages/MessageView.tsx` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –≤–ª–æ–∂–µ–Ω–∏–π + –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:

1. **Backward Compatibility:** –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã legacy-–ø–æ–ª—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
2. **State Management:** ObjectUploader –∏—Å–ø–æ–ª—å–∑—É–µ—Ç useEffect –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
3. **Security:** ACL-–ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
4. **UX:** Blob API –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è cross-origin —Ñ–∞–π–ª–æ–≤

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–î–∞–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö –≤–ª–æ–∂–µ–Ω–∏–π, –ø—Ä–∏ —ç—Ç–æ–º **–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è –ø–æ–ª–Ω—É—é —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö**.

**–í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** ~10-15 –º–∏–Ω—É—Ç  
**–í—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è:** ~5 –º–∏–Ω—É—Ç (—Ç–æ–ª—å–∫–æ –Ω–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞)  
**–†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ backup - –Ω—É–ª–µ–≤–æ–π)

**–£–¥–∞—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è!** üöÄ
